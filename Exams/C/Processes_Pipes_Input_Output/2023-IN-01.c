ะะฐัะธ ะบะพะปะตะณะธ โ ะฐัะธััะตะฝัะธ ะฟะพ ะะก โ ะธะผะฐั ะฝัะถะดะฐ ะพั ะดะตะผะพัััะฐัะธะพะฝะฝะฐ ะฟัะพะณัะฐะผะฐ ะฝะฐ C, ะบะพััะพ ะดะฐ ัะปัะถะธ ะบะฐัะพ
ะฟัะธะผะตั ะทะฐ ะบะพะฝะบััะตะฝัะฝะพัั ะธ ัะธะฝััะพะฝะธะทะฐัะธั ะฝะฐ ะฟัะพัะตัะธ.
ะะตัะธะฝะธัะฐะฝ ะต ะฝะฐัะตะดะตะฝ ัะฟะธััะบ ั ััะธ ะดัะผะธ ๐ฟ = ("๐ก๐๐ " , "๐ก๐๐ " , "๐ก๐๐\๐"), ะบะฐัะพ ะฒััะบะฐ ะดัะผะฐ ะต ั ะดัะปะถะธะฝะฐ
ัะตัะธัะธ ะทะฝะฐะบะฐ. ะะฐะฟะธัะตัะต ะฟัะพะณัะฐะผะฐ, ะฟัะธะตะผะฐัะฐ ะดะฒะต ัะธัะปะฐ ะบะฐัะพ ะฐัะณัะผะตะฝัะธ (./main NC WC), ะบะฐัะพ ๐๐ถ ะต
ะพะณัะฐะฝะธัะตะฝะพ ะฒ ะธะฝัะตัะฒะฐะปะฐ [1, 7], ะฐ๐ ๐ถ โ ะฒ ะธะฝัะตัะฒะฐะปะฐ [1, 35]. ะัะพะณัะฐะผะฐัะฐ ัััะฑะฒะฐ ะทะฐะดัะปะถะธัะตะปะฝะพ ะดะฐ ัะฐะฑะพัะธ
ะฟะพ ัะปะตะดะฝะธั ะพะฑั ะฐะปะณะพัะธััะผ:
โข ะฝะฐัะฐะปะฝะธัั (ัะพะดะธัะตะปัะบะธ) ะฟัะพัะตั ััะทะดะฐะฒะฐ ๐๐ถ ะฝะฐ ะฑัะพะน ะฟัะพัะตัะธ-ะฝะฐัะปะตะดะฝะธัะธ;
โข ะณััะฟะฐัะฐ ะฟัะพัะตัะธ ะธะทะฒะตะถะดะฐั ะฝะฐ stdout ะพะฑัะพ ๐ ๐ถ ะฝะฐ ะฑัะพะน ะดัะผะธ ะพั ะณะพัะฝะธั ัะฟะธััะบ ะฟัะธ ัะปะตะดะฝะธัะต
ะฟัะฐะฒะธะปะฐ:
58
โ ะฐะบะพ ะฑัะพัั ะฝะฐ ะดัะผะธัะต ะทะฐ ะธะทะฒะตะถะดะฐะฝะต ๐ ๐ถ ะต ะฟะพ-ะณะพะปัะผ ะพั ะพะฑัะธั ะฑัะพะน ะดัะผะธ ะฒ๐ฟ, ัะปะตะด ะธะทัะตัะฟะฒะฐะฝะต
ะฝะฐ ะดัะผะธัะต ะฒ ๐ฟ ะฟัะพะณัะฐะผะฐัะฐ ะทะฐะฟะพัะฒะฐ ัะฟะธััะบะฐ ะพัะฝะฐัะฐะปะพ ะบะพะปะบะพัะพ ะฟััะธ ะต ะฝัะถะฝะพ;
โ ะฒัะตะบะธ ะฟัะพัะตั ะธะทะฒะตะถะดะฐ ัะฐะผะพ ะตะดะฝะฐ ะดัะผะฐ;
โ ะฟััะฒะฐัะฐ ะดัะผะฐ ัะต ะธะทะฒะตะถะดะฐ ะพั ัะพะดะธัะตะปัะบะธั ะฟัะพัะตั;
โ ะฐะบะพ ะฑัะพัั ะฝะฐ ะดัะผะธัะต ะทะฐ ะธะทะฒะตะถะดะฐะฝะต ๐ ๐ถ ะต ะฟะพ-ะณะพะปัะผ ะพั ะพะฑัะธั ะฑัะพะน ะฟัะพัะตัะธ, ัะปะตะด ะธะทัะตัะฟะฒะฐะฝะต
ะฝะฐ ะฟัะพัะตัะธัะต ะฟัะพะณัะฐะผะฐัะฐ ะทะฐะฟะพัะฒะฐ ะดะฐ ะณะธ ะฟะพะปะทะฒะฐ ะพั ะฝะฐัะฐะปะพ. ะะฐะฟัะธะผะตั ะฟัะธ ัะพะดะธัะตะปัะบะธ ะฟัะพัะตั
๐ ะธ ะดะฒะฐ ะฟัะพัะตัะฐ-ะฝะฐัะปะตะดะฝะธัะธ ๐ถ1 ะธ ๐ถ2
ัะตะดัั ะฝะฐ ะธะทะฟะพะปะทะฒะฐะฝะต ะฝะฐ ะฟัะพัะตัะธัะต ัะต ะฑัะดะต ๐, ๐ถ1
, ๐ถ2
,
๐, ๐ถ1
, ๐ถ2
, ๐, ๐ถ1
, ...
โ ะธะทะฒะตะดะตะฝะธัะต ะดัะผะธ ะณะฐัะฐะฝัะธัะฐะฝะพ ัััะฑะฒะฐ ะดะฐ ัะฐ ะฟะพ ัะตะดะฐ, ะดะตัะธะฝะธัะฐะฝ ะฒ ๐ฟ;
โ ะฒัะตะบะธ ะฟัะพัะตั ะณะฐัะฐะฝัะธัะฐะฝะพ ะทะฐะฟะพัะฒะฐ ะดะฐ ะธะทะฒะตะถะดะฐ ะฝะฐ stdout ะฟะพัะตะดะฝะฐัะฐ ะดัะผะฐ, ัะปะตะด ะบะฐัะพ ะฟัะตะดัะพะดะฝะธั ะฟัะพัะตั ะต ะฟัะธะบะปััะธะป ั ะธะทะฒะตะถะดะฐะฝะตัะพ ะฝะฐ ะฟัะตะดะธัะฝะฐัะฐ.
ะะฐะฑะตะปะตะถะบะฐ: ะะฐ ะบะพะฝะฒะตััะธัะฐะฝะต ะฝะฐ ะฐัะณัะผะตะฝัะธัะต ะฟะพะณะปะตะดะฝะตัะต strtol(3).

  #include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/wait.h>
#include <string.h>

#define WORDS_COUNT 3

int main(int argc, char *argv[]) {
    if (argc != 3) {
        fprintf(stderr, "Usage: %s NC WC\n", argv[0]);
        return 1;
    }

    int NC = strtol(argv[1], NULL, 10); // ะฑัะพะน child ะฟัะพัะตัะธ
    int WC = strtol(argv[2], NULL, 10); // ะฑัะพะน ะดัะผะธ ะทะฐ ะธะทะฒะตะถะดะฐะฝะต

    if (NC < 1 || NC > 7 || WC < 1 || WC > 35) {
        fprintf(stderr, "NC in [1,7], WC in [1,35]\n");
        return 1;
    }

    const char *words[WORDS_COUNT] = {"tic ", "tac ", "toen"};

    // ััะทะดะฐะฒะฐะผะต pipe-ะพะฒะต ะทะฐ ัะธะฝััะพะฝะธะทะฐัะธั ะผะตะถะดั ะฟัะพัะตัะธัะต
    int pipes[NC+1][2]; // P0(parent) + NC children
    for (int i = 0; i <= NC; i++) {
        if (pipe(pipes[i]) == -1) { perror("pipe"); exit(1); }
    }

    pid_t children[NC];
    for (int i = 0; i < NC; i++) {
        pid_t pid = fork();
        if (pid < 0) { perror("fork"); exit(1); }
        if (pid == 0) {
            // child ะฟัะพัะตั
            for (int j = 0; j < WC; j++) {
                int turn = j % (NC + 1); // ะบะพะน ะฟัะพัะตั ัััะฑะฒะฐ ะดะฐ ะฟะตัะฐัะฐ
                if (turn != i+1) continue; // child i+1 (parent ะต 0)

                char buf;
                read(pipes[i+1][0], &buf, 1); // ัะฐะบะฐ ัะธะณะฝะฐะป ะพั ะฟัะตะดัะพะดะฝะธั

                // ะธะทัะธัะปัะฒะฐะผะต ะดัะผะฐัะฐ ะทะฐ ะฟะตัะฐั
                const char *word = words[j % WORDS_COUNT];
                write(STDOUT_FILENO, word, strlen(word));

                // ัะธะณะฝะฐะปะธะทะธัะฐ ัะปะตะดะฒะฐัะธั ะฟัะพัะตั
                write(pipes[(i+2) % (NC+1)][1], "x", 1);
            }
            // child ะทะฐะฒัััะฒะฐ
            return 0;
        }
        children[i] = pid;
    }

    // parent ะฟัะพัะตั
    for (int j = 0; j < WC; j++) {
        int turn = j % (NC + 1);
        if (turn != 0) {
            char buf;
            read(pipes[0][0], &buf, 1); // ัะฐะบะฐ ัะธะณะฝะฐะป
        }

        // ะฟะตัะฐั ะฝะฐ ะดัะผะฐัะฐ
        const char *word = words[j % WORDS_COUNT];
        write(STDOUT_FILENO, word, strlen(word));

        // ัะธะณะฝะฐะปะธะทะธัะฐ ัะปะตะดะฒะฐัะธั ะฟัะพัะตั
        write(pipes[1][1], "x", 1);
    }

    // ัะฐะบะฐะผะต ะฒัะธัะบะธ ะดะตัะฐ
    for (int i = 0; i < NC; i++) wait(NULL);

    write(STDOUT_FILENO, "\n", 1);
    return 0;
}
