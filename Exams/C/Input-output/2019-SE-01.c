 –í –ø—Ä–∏–ª–æ–∂–Ω–∞—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–µ—Å—Ç–æ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç —Å–ª–µ–¥–Ω–∏—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª–Ω–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –¥–∞–¥–µ–Ω–∞
–∏–∑–≤–∞–¥–∫–∞:
47
‚Ä¢ —Å—Ä–µ–¥–Ω–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç ÃÑùë• = 1
ùëÅ
ùëÅ
‚àë
ùëñ=1
ùë•ùëñ
‚Ä¢ –¥–∏—Å–ø–µ—Ä—Å–∏—è ùê∑ = 1
ùëÅ
ùëÅ
‚àë
ùëñ=1
(ùë•ùëñ ‚àí ÃÑùë•)2
–∫—ä–¥–µ—Ç–æ {ùë•1
, ùë•2
, ‚Ä¶ , ùë•ùëÅ} —Å–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏—Ç–µ –Ω–∞ –∏–∑–≤–∞–¥–∫–∞—Ç–∞, –∞ ùëÅ –µ —Ç–µ—Ö–Ω–∏—è –±—Ä–æ–π.
–ù–∞–ø–∏—à–µ—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–∞ –Ω–∞ C, –∫–æ—è—Ç–æ –ø—Ä–∏–µ–º–∞ –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—ä—Ä ‚Äì –∏–º–µ –Ω–∞ –¥–≤–æ–∏—á–µ–Ω —Ñ–∞–π–ª. –§–∞–π–ª—ä—Ç
—Å—ä–¥—ä—Ä–∂–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏, –∫–æ–∏—Ç–æ —Å–∞ –≤–ª–∏–∑–∞–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞, –∏ —Å–µ —Å—ä—Å—Ç–æ–∏ –æ—Ç –Ω–∞—Ä–µ–¥–µ–Ω–∏ –ø–µ—Ç–æ—Ä–∫–∏
–æ—Ç —Å–ª–µ–¥–Ω–∏—Ç–µ –µ–ª–µ–º–µ–Ω—Ç–∏ –∏ —Ç–µ—Ö–Ω–∏—Ç–µ —Ç–∏–ø–æ–≤–µ:
‚Ä¢ —É–Ω–∏–∫–∞–ª–µ–Ω –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (UID) uint32_t
‚Ä¢ –∑–∞–ø–∞–∑–µ–Ω–æ1 uint16_t ‚Äì –Ω–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –≤ –∑–∞–¥–∞—á–∞—Ç–∞
‚Ä¢ –∑–∞–ø–∞–∑–µ–Ω–æ2 uint16_t ‚Äì –Ω–µ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –≤ –∑–∞–¥–∞—á–∞—Ç–∞
‚Ä¢ –≤—Ä–µ–º–µ1 uint32_t ‚Äì –º–æ–º–µ–Ω—Ç –Ω–∞ –∑–∞–ø–æ—á–≤–∞–Ω–µ –Ω–∞ —Å–µ—Å–∏—è—Ç–∞ (Unix time)
‚Ä¢ –≤—Ä–µ–º–µ2 uint32_t ‚Äì –º–æ–º–µ–Ω—Ç –Ω–∞ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ –Ω–∞ —Å–µ—Å–∏—è—Ç–∞ (Unix time)
–ó–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏, –∫–æ–∏—Ç–æ —Å–∞ –∏–º–∞–ª–∏ —Å–µ—Å–∏–∏, –∫–≤–∞–¥—Ä–∞—Ç—ä—Ç –Ω–∞ –ø—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ –∫–æ–∏—Ç–æ –µ –ø–æ-–≥–æ–ª—è–º –æ—Ç –¥–∏—Å–ø–µ—Ä—Å–∏—è—Ç–∞ ùê∑ –Ω–∞ –ø—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ –≤—Å–∏—á–∫–∏ —Å–µ—Å–∏–∏ –≤—ä–≤ —Ñ–∞–π–ª–∞, –ø—Ä–æ–≥—Ä–∞–º–∞—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–∑–≤–µ–¥–µ –Ω–∞ STDOUT
–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏—è—Ç –∏–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏ –ø—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ –Ω–∞–π-–¥—ä–ª–≥–∞—Ç–∞ –∏–º —Å–µ—Å–∏—è.

    #include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <fcntl.h>
#include <unistd.h>
#include <err.h>
#include <math.h>

typedef struct {
    uint32_t uid;
    uint16_t reserved1;
    uint16_t reserved2;
    uint32_t time1;
    uint32_t time2;
} record_t;

int main(int argc, char **argv) {
    if (argc != 2) {
        errx(1, "Usage: %s <file>", argv[0]);
    }

    const char *file_name = argv[1];
    int fd = open(file_name, O_RDONLY);
    if (fd < 0) err(2, "Cannot open %s", file_name);

    // –ß–µ—Ç–µ–º —Ü–µ–ª–∏—è —Ñ–∞–π–ª –≤ –ø–∞–º–µ—Ç (–º–∞–∫—Å–∏–º—É–º 100 000 –∑–∞–ø–∏—Å–∞)
    off_t file_size = lseek(fd, 0, SEEK_END);
    if (file_size < 0) err(3, "lseek failed");
    if (lseek(fd, 0, SEEK_SET) < 0) err(4, "lseek failed");

    size_t n = file_size / sizeof(record_t);
    if (n == 0) {
        close(fd);
        return 0;
    }

    record_t *records = malloc(n * sizeof(record_t));
    if (!records) errx(5, "Memory allocation failed");

    ssize_t bytes_read = read(fd, records, n * sizeof(record_t));
    if (bytes_read < 0) err(6, "Read error");
    if ((size_t)bytes_read != n * sizeof(record_t)) errx(7, "Could not read full file");

    close(fd);

    // –ò–∑—á–∏—Å–ª—è–≤–∞–º–µ –ø—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç–∏—Ç–µ
    double sum = 0.0;
    double sum_sq = 0.0;
    uint32_t *durations = malloc(n * sizeof(uint32_t));
    if (!durations) errx(8, "Memory allocation failed");

    for (size_t i = 0; i < n; i++) {
        uint32_t dur = records[i].time2 - records[i].time1;
        durations[i] = dur;
        sum += dur;
    }

    double mean = sum / n;

    double variance = 0.0;
    for (size_t i = 0; i < n; i++) {
        double diff = durations[i] - mean;
        variance += diff * diff;
    }
    variance /= n;

    // –ù–∞–º–∏—Ä–∞–º–µ –Ω–∞–π-–¥—ä–ª–≥–∞—Ç–∞ —Å–µ—Å–∏—è –∑–∞ –≤—Å–µ–∫–∏ UID –∏ –ø—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ —É—Å–ª–æ–≤–∏–µ—Ç–æ
    typedef struct {
        uint32_t uid;
        uint32_t max_dur;
    } user_t;

    user_t *users = malloc(n * sizeof(user_t));
    if (!users) errx(9, "Memory allocation failed");
    size_t user_count = 0;

    for (size_t i = 0; i < n; i++) {
        uint32_t uid = records[i].uid;
        uint32_t dur = durations[i];
        int found = 0;
        for (size_t j = 0; j < user_count; j++) {
            if (users[j].uid == uid) {
                if (dur > users[j].max_dur) users[j].max_dur = dur;
                found = 1;
                break;
            }
        }
        if (!found) {
            users[user_count].uid = uid;
            users[user_count].max_dur = dur;
            user_count++;
        }
    }

    for (size_t i = 0; i < user_count; i++) {
        if ((double)(users[i].max_dur) * (double)(users[i].max_dur) > variance) {
            printf("%u %u\n", users[i].uid, users[i].max_dur);
        }
    }

    free(records);
    free(durations);
    free(users);

    return 0;
}

–ú–æ–∂–µ—Ç–µ –¥–∞ —Ä–∞–∑—á–∏—Ç–∞—Ç–µ –Ω–∞ —Ç–æ–≤–∞, —á–µ –≤—ä–≤ —Ñ–∞–π–ª–∞ —â–µ –∏–º–∞ –Ω–µ –ø–æ–≤–µ—á–µ –æ
