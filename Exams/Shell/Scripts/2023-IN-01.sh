Ð’Ð°ÑˆÐ¸Ñ‚Ðµ ÐºÐ¾Ð»ÐµÐ³Ð¸ Ð¾Ñ‚ ÑÑŠÑÐµÐ´Ð½Ð°Ñ‚Ð° Ð»Ð°Ð±Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€Ð¸Ñ Ð¸Ð¼Ð°Ñ‚ Ð½ÑÐºÐ¾Ð»ÐºÐ¾ GNU/Linux Ð¼Ð°ÑˆÐ¸Ð½Ð¸ ÑÑŠÑ ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ð¸ RAID
ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÐµÑ€Ð¸ Ð¸ Ð¿Ð¾Ð»Ð·Ð²Ð°Ñ‚ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð°Ð½Ð° ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð·Ð° Ð½Ð°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ðµ Hugin. ÐŸÐ¾Ð¼Ð¾Ð³Ð½ÐµÑ‚Ðµ Ð½Ð° ÐºÐ¾Ð»ÐµÐ³Ð¸Ñ‚Ðµ ÑÐ¸, ÐºÐ°Ñ‚Ð¾
Ð½Ð°Ð¿Ð¸ÑˆÐµÑ‚Ðµ shell ÑÐºÑ€Ð¸Ð¿Ñ‚, ÐºÐ¾Ð¹Ñ‚Ð¾ Ð²Ð·Ð¸Ð¼Ð° Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð°Ñ‚Ð° Ð½Ð° Ð´Ð¸ÑÐºÐ¾Ð²ÐµÑ‚Ðµ, Ð·Ð°ÐºÐ°Ñ‡ÐµÐ½Ð¸ ÐºÑŠÐ¼ Ñ‚ÐµÐ·Ð¸ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÐµÑ€Ð¸, Ð¸
Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð° Ð¸Ð·Ñ…Ð¾Ð´, ÑƒÐ´Ð¾Ð±ÐµÐ½ Ð·Ð° Ð¿Ð¾Ð»Ð·Ð²Ð°Ð½Ðµ Ð¾Ñ‚ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ñ‚Ð° Ð·Ð° Ð½Ð°Ð±Ð»ÑŽÐ´ÐµÐ½Ð¸Ðµ.
Ð—Ð° Ð´Ð¾ÑÑ‚ÑŠÐ¿ Ð´Ð¾ Ð´Ð°Ð½Ð½Ð¸Ñ‚Ðµ Ð½Ð° Ð´Ð¸ÑÐºÐ¾Ð²ÐµÑ‚Ðµ, ÐºÐ¾Ð»ÐµÐ³Ð¸Ñ‚Ðµ Ð²Ð¸ ÐºÐ°Ð·Ð²Ð°Ñ‚, Ñ‡Ðµ root Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»Ñ Ð¼Ð¾Ð¶Ðµ Ð´Ð° Ð¸Ð·Ð¿ÑŠÐ»Ð½Ð¸ ÑÐ»ÐµÐ´Ð½Ð°Ñ‚Ð°
ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°, ÐºÐ¾ÑÑ‚Ð¾ Ð²Ð·Ð¸Ð¼Ð° Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾Ñ‚ Ð´Ð°Ð´ÐµÐ½ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÐµÑ€:
ssacli ctrl slot=x pd all show detail
ÐºÑŠÐ´ÐµÑ‚Ð¾ ð‘¥ Ðµ Ð½Ð¾Ð¼ÐµÑ€ Ð½Ð° PCI ÑÐ»Ð¾Ñ‚, Ð² ÐºÐ¾Ð¹Ñ‚Ð¾ Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÐµÑ€Ð°. ÐŸÑ€Ð¸Ð¼ÐµÑ€ÐµÐ½ Ð¸Ð·Ñ…Ð¾Ð´ Ð¾Ñ‚ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ñ‚Ð°:
Smart Array P420i in Slot 0 (Embedded)
Array A
physicaldrive 1I:2:1
Rotational Speed: 15000
Current Temperature (C): 35
physicaldrive 1I:2:2
Interface Type: SAS
Current Temperature (C): 36
SMR Support: None
physicaldrive 1I:2:3
Status: OK
Drive Type: Spare Drive
Current Temperature (C): 34
Maximum Temperature (C): 42
28
ÐžÑ‰Ðµ ÐµÐ´Ð¸Ð½ Ð¿Ñ€Ð¸Ð¼ÐµÑ€:
Smart Array P822 in Slot 1
Array J
physicaldrive 2E:1:19
Current Temperature (C): 29
physicaldrive 2E:1:20
Current Temperature (C): 28
Unassigned
physicaldrive 2E:1:21
Current Temperature (C): 30
physicaldrive 2E:1:22
Current Temperature (C): 29
ÐÐºÐ¾ Ð¾Ð±Ð¾Ð±Ñ‰Ð¸Ð¼, Ð¸Ð·Ñ…Ð¾Ð´ÑŠÑ‚ Ð¸Ð·Ð³Ð»ÐµÐ¶Ð´Ð° Ñ‚Ð°ÐºÐ°:
â€¢ Ð¾Ð±Ñ‰Ð° Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð·Ð° ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÐµÑ€Ð° Ð² ÑÑŠÐ¾Ñ‚Ð²ÐµÑ‚Ð½Ð¸Ñ ÑÐ»Ð¾Ñ‚, Ð¸ Ñ‡Ð°ÑÑ‚Ð½Ð¾ÑÑ‚, Ð¼Ð¾Ð´ÐµÐ» Ð½Ð° ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÐµÑ€Ð° (P420i/P822)
â€¢ ÐµÐ´Ð½Ð° Ð¸Ð»Ð¸ Ð¿Ð¾Ð²ÐµÑ‡Ðµ ÑÐµÐºÑ†Ð¸Ð¸ Ð½Ð° Ð²Ñ‚Ð¾Ñ€Ð¾ Ð½Ð¸Ð²Ð¾, Ð´ÐµÑ„Ð¸Ð½Ð¸Ñ€Ð°Ñ‰Ð¸ (Ð½ÑƒÐ»Ð° Ð¸Ð»Ð¸ Ð¿Ð¾Ð²ÐµÑ‡Ðµ) Ð¼Ð°ÑÐ¸Ð²Ð¸ Ð¸Ð»Ð¸ (Ð½ÑƒÐ»Ð° Ð¸Ð»Ð¸
ÐµÐ´Ð½Ð°) ÑÐµÐºÑ†Ð¸Ñ Ñ Ð½ÐµÐ¸Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ð½Ð¸ Ð´Ð¸ÑÐºÐ¾Ð²Ðµ (Array A/Array J/Unassigned), ÐºÐ°Ñ‚Ð¾ Ð±ÑƒÐºÐ²Ð°Ñ‚Ð° (A, J, ...) Ð´ÐµÑ„Ð¸Ð½Ð¸Ñ€Ð° Ð¸Ð¼ÐµÑ‚Ð¾ Ð½Ð° Ð¼Ð°ÑÐ¸Ð²Ð° Ð² Ñ€Ð°Ð¼ÐºÐ¸Ñ‚Ðµ Ð½Ð° ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÐµÑ€Ð°
â€¢ Ð²ÑŠÐ² Ð²ÑÑÐºÐ° Ñ‚Ð°ÐºÐ°Ð²Ð° ÑÐµÐºÑ†Ð¸Ñ Ð¸Ð¼Ð° ÐµÐ´Ð½Ð° Ð¸Ð»Ð¸ Ð¿Ð¾Ð²ÐµÑ‡Ðµ Ð¿Ð¾Ð´ÑÐµÐºÑ†Ð¸Ð¸ Ð·Ð° Ð´Ð¸ÑÐºÐ¾Ð²Ðµ Ð² ÑÑŠÐ¾Ñ‚Ð²ÐµÑ‚Ð½Ð¸Ñ Ð¼Ð°ÑÐ¸Ð² (physicaldrive
1I:2:1, physicaldrive 2E:1:22, Ð¸ Ñ‚.Ð½.), ÐºÑŠÐ´ÐµÑ‚Ð¾ Ð½Ð¸Ð·ÑŠÑ‚ ÑÐ»ÐµÐ´ physicaldrive Ðµ Ð¸Ð¼Ðµ Ð½Ð° Ñ‚Ð¾Ð·Ð¸ Ð´Ð¸ÑÐº Ð²
Ñ€Ð°Ð¼ÐºÐ¸Ñ‚Ðµ Ð½Ð° ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÐµÑ€Ð°
â€¢ Ð²ÑŠÐ² Ð²ÑÑÐºÐ° Ð¿Ð¾Ð´ÑÐµÐºÑ†Ð¸Ñ Ð·Ð° Ð´Ð°Ð´ÐµÐ½ Ð´Ð¸ÑÐº Ð¸Ð¼Ð° Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð¾ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸ Ð²ÑŠÐ² Ð²Ð¸Ð´Ð° key name: value ÐºÐ°Ñ‚Ð¾ Ð·Ð°
ÐºÐ¾Ð»ÐµÐ³Ð¸Ñ‚Ðµ Ð²Ð¸ Ðµ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐµÐ½ ÑÐ°Ð¼Ð¾ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚ÑŠÑ€ÑŠÑ‚ Current Temperature (C)
ÐÐµÐºÐ° Ð²ÑŠÐ²ÐµÐ´ÐµÐ¼ ÑÐ»ÐµÐ´Ð½Ð¸Ñ‚Ðµ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð¸:
â€¢ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð½Ð° Ð´Ð¸ÑÐº â€“ Ð½Ð¸Ð· Ð²ÑŠÐ² Ð²Ð¸Ð´Ð° â€œSSAcmmmapppâ€, ÐºÑŠÐ´ÐµÑ‚Ð¾:
â€“ SSA â€“ Ð»Ð¸Ñ‚ÐµÑ€Ð°Ð»
â€“ ð‘ â€“ Ð½Ð¾Ð¼ÐµÑ€ Ð½Ð° ÑÐ»Ð¾Ñ‚
â€“ ð‘šð‘šð‘š â€“ Ð¼Ð¾Ð´ÐµÐ» Ð½Ð° ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÐµÑ€
â€“ ð‘Ž â€“ Ð¸Ð¼Ðµ Ð½Ð° Ð¼Ð°ÑÐ¸Ð² Ð¸Ð»Ð¸ UN Ð¿Ñ€Ð¸ Ð½ÐµÐ¸Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ð½ Ð´Ð¸ÑÐº
â€“ ð‘ð‘ð‘ â€“ Ð¸Ð¼Ðµ Ð½Ð° Ð´Ð¸ÑÐº, Ð±ÐµÐ· Ð´Ð²ÑƒÐµÑ‚Ð¾Ñ‡Ð¸Ñ
â€¢ label Ð½Ð° Ð´Ð¸ÑÐº â€“ Ð½Ð¸Ð· Ð²ÑŠÐ² Ð²Ð¸Ð´Ð° â€œSSAc mmm Ð° qqqâ€, ÐºÑŠÐ´ÐµÑ‚Ð¾
â€“ ð‘žð‘žð‘ž â€“ Ð¸Ð¼Ðµ Ð½Ð° Ð´Ð¸ÑÐº
â€“ Ð¾ÑÑ‚Ð°Ð½Ð°Ð»Ð¸Ñ‚Ðµ Ð¿Ð¾Ð»ÐµÑ‚Ð° ÑÐ° Ð¿Ð¾ Ð³Ð¾Ñ€Ð½Ð°Ñ‚Ð° Ð´ÐµÑ„Ð¸Ð½Ð¸Ñ†Ð¸Ñ
â€¢ Ð·Ð°Ð±ÐµÐ»ÐµÐ¶ÐºÐ°: ÐºÐ°Ð²Ð¸Ñ‡ÐºÐ¸Ñ‚Ðµ Ð½Ðµ ÑÐ° Ñ‡Ð°ÑÑ‚ Ð¾Ñ‚ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð° Ð¸Ð»Ð¸ Ð¾Ñ‚ label-Ð° Ð½Ð° Ð´Ð°Ð´ÐµÐ½ Ð´Ð¸ÑÐº.
Ð’ÑŠÐ·Ð¼Ð¾Ð¶Ð½Ð¾ Ðµ Ð´Ð° ÑÑŠÑ‰ÐµÑÑ‚Ð²ÑƒÐ²Ð° environment Ð¿Ñ€Ð¾Ð¼ÐµÐ½Ð»Ð¸Ð²Ð° CTRLSLOTS, Ñ‡Ð¸ÑÑ‚Ð¾ ÑÑ‚Ð¾Ð¹Ð½Ð¾ÑÑ‚ Ð´Ð° Ðµ ÐµÐ´Ð¸Ð½ Ð¸Ð»Ð¸ Ð¿Ð¾Ð²ÐµÑ‡Ðµ
Ð½Ð¾Ð¼ÐµÑ€Ð° Ð½Ð° PCI ÑÐ»Ð¾Ñ‚Ð¾Ð²Ðµ, Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸ Ñ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¸, Ð¸ Ð² Ñ‚Ð¾Ð·Ð¸ ÑÐ»ÑƒÑ‡Ð°Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ÑŠÑ‚ Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð¸Ð·Ð²ÐµÐ¶Ð´Ð° Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾Ñ‚ Ñ‚ÐµÐ·Ð¸ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÐµÑ€Ð¸. ÐÐºÐ¾ Ñ‚Ð°ÐºÐ°Ð²Ð° Ð¿Ñ€Ð¾Ð¼ÐµÐ½Ð»Ð¸Ð²Ð° Ð½Ðµ Ðµ Ð´ÐµÑ„Ð¸Ð½Ð¸Ñ€Ð°Ð½Ð°, ÑÐºÑ€Ð¸Ð¿Ñ‚ÑŠÑ‚ Ð¿Ð¾ Ð¿Ð¾Ð´Ñ€Ð°Ð·Ð±Ð¸Ñ€Ð°Ð½Ðµ Ð´Ð°
Ñ€Ð°Ð±Ð¾Ñ‚Ð¸ Ñ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÐµÑ€Ð° Ð² ÑÐ»Ð¾Ñ‚ 0.
Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ÑŠÑ‚ Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð¿Ð¾Ð´Ð´ÑŠÑ€Ð¶Ð° ÑÐ»ÐµÐ´Ð½Ð¸Ñ‚Ðµ Ð²Ð¸Ð´Ð¾Ð²Ðµ Ð¸Ð·Ð¿ÑŠÐ»Ð½ÐµÐ½Ð¸Ðµ:
â€¢ Ñ ÐµÐ´Ð¸Ð½ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚ÑŠÑ€ autoconf â€“ ÑÐºÑ€Ð¸Ð¿Ñ‚ÑŠÑ‚ Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð¸Ð·Ð²ÐµÐ¶Ð´Ð° Ð½Ð¸Ð·Ð° yes
â€¢ Ñ ÐµÐ´Ð¸Ð½ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚ÑŠÑ€ config â€“ ÑÐºÑ€Ð¸Ð¿Ñ‚ÑŠÑ‚ Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð¸Ð·Ð²ÐµÐ¶Ð´Ð° ÑÐ»ÐµÐ´Ð½Ð¸Ñ Ð¸Ð·Ñ…Ð¾Ð´:
graph_title SSA drive temperatures
graph_vlabel Celsius
graph_category sensors
graph_info This graph shows SSA drive temp
SSA0P420iA1I21.label SSA0 P420i A 1I:2:1
SSA0P420iA1I21.type GAUGE
SSA0P420iA1I22.label SSA0 P420i A 1I:2:2
SSA0P420iA1I22.type GAUGE
SSA0P420iA1I23.label SSA0 P420i A 1I:2:3
SSA0P420iA1I23.type GAUGE
29
SSA1P822J2E119.label SSA1 P822 J 2E:1:19
SSA1P822J2E119.type GAUGE
SSA1P822J2E120.label SSA1 P822 J 2E:1:20
SSA1P822J2E120.type GAUGE
SSA1P822UN2E121.label SSA1 P822 UN 2E:1:21
SSA1P822UN2E121.type GAUGE
SSA1P822UN2E122.label SSA1 P822 UN 2E:1:22
SSA1P822UN2E122.type GAUGE
â€¢ Ð±ÐµÐ· Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸ â€“ ÑÐºÑ€Ð¸Ð¿Ñ‚ÑŠÑ‚ Ñ‚Ñ€ÑÐ±Ð²Ð° Ð´Ð° Ð¸Ð·Ð²ÐµÐ¶Ð´Ð° ÑÐ»ÐµÐ´Ð½Ð¸Ñ Ð¸Ð·Ñ…Ð¾Ð´:
SSA0P420iA1I21.value 35
SSA0P420iA1I22.value 36
SSA0P420iA1I23.value 34
SSA1P822J2E119.value 29
SSA1P822J2E120.value 28
SSA1P822UN2E121.value 30
SSA1P822UN2E122.value 29
Ð’ Ð³Ð¾Ñ€Ð½Ð¸Ñ‚Ðµ Ð¸Ð·Ñ…Ð¾Ð´Ð¸:
â€¢ Ð½Ð¸Ð·Ð¾Ð²ÐµÑ‚Ðµ, Ð·Ð°Ð¿Ð¾Ñ‡Ð²Ð°Ñ‰Ð¸ Ñ graph ÑÐ° Ð»Ð¸Ñ‚ÐµÑ€Ð°Ð»Ð¸
â€¢ Ð½Ð¸Ð·Ð¾Ð²ÐµÑ‚Ðµ, Ð² ÐºÐ¾Ð¸Ñ‚Ð¾ ÑÐµ ÑÑ€ÐµÑ‰Ð° .label, .type Ð¸Ð»Ð¸ .value Ð·Ð°Ð¿Ð¾Ñ‡Ð²Ð°Ñ‚ Ñ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð½Ð° Ð´Ð¸ÑÐº
â€¢ Ð½Ð¸Ð·ÑŠÑ‚ ÑÐ»ÐµÐ´ .label Ðµ label Ð½Ð° Ð´Ð¸ÑÐº
â€¢ .type Ð²Ð¸Ð½Ð°Ð³Ð¸ Ðµ GAUGE
â€¢ Ñ‡Ð¸ÑÐ»Ð¾Ñ‚Ð¾ ÑÐ»ÐµÐ´ .value Ðµ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð°Ñ‚Ð° Ð½Ð° Ð²ÑŠÐ¿Ñ€Ð¾ÑÐ½Ð¸Ñ Ð´Ð¸ÑÐº

#!/bin/bash

[[ $# -ne 1 || ! -d $1 ]] && echo "1 param expected that is a dir" && exit 1

DIR=$(find $1/cfg -maxdepth 0 -type d)
[[ -z $DIR ]] && echo "cfg directory not foun" && exit 2

validate=$(find "$1/validate.sh" -executable)
[[ -z $validate ]] && echo "validate script not found" && exit 3

passFile=$(find "$1/foo.pwd" -type f)
[[ -z $passFile ]] && echo "password file not found" && exit 4

configFile=$(find "$1/foo.conf" -type f)
[[ -z $configFile ]] && echo "password file not found" && exit 5

files=$(find $DIR -type f -name '*.cfg')

echo "" > $configFile
while read file; do
	basename=$(basename $file)

	output=$($validate $file)
	exitCode=$?

	[[ $exitCode -eq 2 ]] && echo "Problem validating file: $file" && continue
	if [[ $exitCode -eq 1 ]]; then
		echo "$output" | awk -v name="$basename" '{ print name":"$0 }' 1>&2
		continue
	fi
	
	cat $file >> $configFile

	username=$(echo "$basename" | sed -E 's/\.cfg$//g')

	userLine=$(egrep "^$username" $passFile)
	[[ ! -z $userLine ]] && continue

	newPass=$(pwgen 10 1)
	hashedPass=$(mkpasswd $newPass)

	echo "${username}:${newPass}"
	echo "${username}:${hashedPass}" >> $passFile
done < <(echo "$files")
